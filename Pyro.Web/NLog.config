<?xml version="1.0" encoding="utf-8" ?>

<!-- 
    This section defines how the logger it's self logs any issues it may have, i.e can not access log file
    These settings are only relevant for debugging and should not be changed in production
    -->
<nlog throwExceptions="false"
      internalLogToConsole="false"
      internalLogFile="NLogInternalLog.txt"
      internalLogToConsoleError ="true"
      internalLogLevel="Warn"
      xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <!-- 
    These are the variables for the logging, you may wish to change these
    -->
  <variable name="LogFileName" value="PyroServerLog"/>
  <variable name="NumberOfRollingLogs" value="14"/>
  <variable name="HeaderLayout" value="Pyro FHIR Server 
            ${newline}LogMachine: ${machinename} | Windows Identity: ${windows-identity}
            ${newline}Header Key:
            ${newline}=========================================================================================
            ${newline}Time Stamp  |  Level  |  Call Site &amp; Line number  |  Message  |  Stack Trace  |  Guid
            ${newline}========================================================================================="/>

  <variable name="NormalLayout" value="${level}|${callsite} Line#:${callsite-linenumber}|${message}|${stacktrace}|${guid}"/>
  <variable name="NormalFileLayout" value="${longdate}|${NormalLayout}"/>
  <variable name="NormalConsoleLayout" value="${date:format=HH\:mm\:ss}|${NormalLayout}"/>

  <!-- 
    Targets are the sources that messaging can be written to.
   -->
  <targets>
    <!--This target defines the file log parameters and the archiving policy, 
        there should no reason to need to change these, change the variables above 
    -->
    <target name="file" xsi:type="AsyncWrapper" queueLimit="5000" overflowAction="Discard">
      <target xsi:type="RetryingWrapper">
        <target xsi:type="File"
            header="${HeaderLayout}"
            layout= "${NormalFileLayout}"
            fileName="${basedir}\Logs\${LogFileName}.txt"
            archiveFileName="${basedir}/archives/${LogFileName}.{#}.txt"
            archiveEvery="Day"
            archiveNumbering="Rolling"
            maxArchiveFiles="${NumberOfRollingLogs}"
            concurrentWrites="true"
            keepFileOpen="false"
            createDirs="True" />
      </target>
    </target>

    <!-- 
    This target defines the logging seen in the console for debugging.
    -->
    <target name="console" xsi:type="ColoredConsole" layout="${date:format=HH\:mm\:ss}|| ${level} | ${logger} | ${message} | ${stacktrace}" />

  </targets>
  <rules>

    <!-- 
    This section defines rules of which messages to write to which source targets
    You can define complex rules, see rules examples below.
    -->

    <!-- 
    You may wish to increases the level of logging to be more granular or less 
    by changing the 'minlevel' property and setting a new Log Level, see reference below for available levels
    'name=*' means all messages are logged to the target, no filtering applied, except for the minlevel setting
    'writeTo=' points the target as defined above.
    -->
    <!--<logger name="HeaderLogger" minlevel="Trace" writeTo="fileHeader" final="true" />-->
    <logger name="*" minlevel="Info" writeTo="console" />
    <logger name="*" minlevel="Info" writeTo="file" />
  </rules>
</nlog>

<!--
Log Levels:
Trace - Very detailed log messages, potentially of a high frequency and volume
Debug -Less detailed and/or less frequent debugging messages
Info - Informational messages
Warn - Warnings which don't appear to the user of the application
Error - Error messages
Fatal - Fatal error messages. After a fatal error, the application usually terminates.
-->

<!--
Example Rules
<logger name="Name.Space.Class1" minlevel="Debug" writeTo="f1" /> - all messages from Class1 in Name.Space whose level is Debug or higher are written to the "f1" target.
<logger name="Name.Space.Class1" levels="Debug,Error" writeTo="f1" /> - all messages from Class1 in Name.Space whose level is either Debug or Error or higher are written to the "f1" target.
<logger name="Name.Space.*" writeTo="f3,f4" /> - messages from any class in the Name.Space namespace are written to both "f3" and "f4" targets regardless of their levels.
<logger name="Name.Space.*" minlevel="Debug" maxlevel="Error" final="true" /> - messages from any class in the Name.Space namespace whose level is between Debug and Error (which makes it Debug, Info, Warn, Error) are rejected (as there's no writeTo clause) and no further rules are processed for them (because of the final="true" setting).
-->

